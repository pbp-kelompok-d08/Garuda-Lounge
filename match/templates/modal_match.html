{% load static %}

<div id="matchModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">
  <div id="matchModalContent" 
       class="bg-white rounded-2xl shadow-[6px_6px_0_#111] border-2 border-[#111111] w-11/12 sm:w-3/5 lg:w-4/5 max-h-[90vh] overflow-y-auto transform scale-95 opacity-0 transition-all duration-200">

    <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200 bg-[#E7E3DD] rounded-t-2xl">
      <div>
        <h3 class="text-xl font-extrabold font-[Montserrat] text-[#111111]">
          Tambah Match Baru
        </h3>
        <p class="text-sm text-[#555] mt-1 font-[Inter]">
          Masukkan detail pertandingan baru
        </p>
      </div>
      <button type="button"
              class="text-[#111111] hover:bg-[#ffffffcc] rounded-md p-2 transition"
              onclick="hideMatchModal()"
              aria-label="Close">
        âœ•
      </button>
    </div>

    <div class="px-6 py-5 space-y-5 font-[Inter] text-[#111111]">
      <form id="matchForm" class="space-y-4">
        {% csrf_token %}
        {% for field in form %}
        <div>
          <label for="{{ field.id_for_label }}" class="block text-sm font-semibold mb-2" style="color:#a4161a">
            <b>{{ field.label }}</b>
          </label>
          <div class="text-sm font-medium text-gray-900">
            {{ field }}
          </div>
          {% if field.help_text %}
          <p class="mt-1 text-sm text-gray-500">{{ field.help_text }}</p>
          {% endif %}
          {% for error in field.errors %}
          <p class="mt-1 text-sm text-red-600">{{ error }}</p>
          {% endfor %}
        </div>
        {% endfor %}
      </form>
    </div>

    <div class="flex flex-col sm:flex-row gap-3 px-6 py-5 border-t border-gray-200 bg-[#E7E3DD] rounded-b-2xl">
      <button type="button"
              class="order-2 sm:order-1 w-full sm:w-auto px-6 py-3 border-2 border-[#111111] text-[#111111] bg-white rounded-xl font-bold hover:bg-[#f5f5f5] transition"
              onclick="hideMatchModal()">
        Cancel
      </button>
      <button type="submit"
              form="matchForm"
              class="order-1 sm:order-2 w-full sm:w-auto px-6 py-3 bg-[#AA1515] text-white rounded-xl font-bold border-2 border-[#111111] hover:brightness-110 hover:-translate-y-0.5 transition">
        Simpan Pertandingan
      </button>
    </div>
  </div>
</div>

<script>
  function showMatchModal() {
    const modal = document.getElementById('matchModal');
    const modalContent = document.getElementById('matchModalContent');
    modal.classList.remove('hidden');
    setTimeout(() => {
      modalContent.classList.remove('opacity-0', 'scale-95');
      modalContent.classList.add('opacity-100', 'scale-100');
    }, 30);
  }

  function hideMatchModal() {
    const modal = document.getElementById('matchModal');
    const modalContent = document.getElementById('matchModalContent');
    modalContent.classList.remove('opacity-100', 'scale-100');
    modalContent.classList.add('opacity-0', 'scale-95');
    setTimeout(() => modal.classList.add('hidden'), 180);
  }

  async function addMatchEntry() {
    // PENTING: Anda harus membuat URL 'match:add_match_ajax' ini di match/urls.py
    // dan view-nya di match/views.py
    const res = await fetch("{% url 'match:add_match_ajax' %}", {
      method: "POST",
      body: new FormData(document.querySelector('#matchForm')),
    });

    document.getElementById("matchForm").reset();
    hideMatchModal();

    // Tampilkan toast
    if (typeof showToast === 'function') {
      showToast('Success', 'Match added successfully!', 'success');
    }

    // Trigger refresh data di halaman match.html (jika Anda menggunakan AJAX di sana)
    document.dispatchEvent(new CustomEvent('matchAdded'));
  }

  document.getElementById("matchForm").addEventListener("submit", function(e) {
    e.preventDefault();
    addMatchEntry();
  });
</script>