{% load static %}

<!-- Modal -->
<div id="crudModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">
  <div id="crudModalContent" 
       class="bg-white rounded-2xl shadow-[6px_6px_0_#111] border-2 border-[#111111] w-11/12 sm:w-3/5 lg:w-2/5 xl:w-1/3 max-h-[90vh] overflow-y-auto transform scale-95 opacity-0 transition-all duration-200">

    <!-- Header -->
    <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200 bg-[#E7E3DD] rounded-t-2xl">
      <div>
        <h3 class="text-xl font-extrabold font-[Montserrat] text-[#111111]">
          Create News
        </h3>
        <p class="text-sm text-[#555] mt-1 font-[Inter]">
          Share your football news and stories with the community
        </p>
      </div>
      <button type="button"
              class="text-[#111111] hover:bg-[#ffffffcc] rounded-md p-2 transition"
              onclick="hideModal()"
              aria-label="Close">
        âœ•
      </button>
    </div>

    <!-- Body -->
    <div class="px-6 py-5 space-y-5 font-[Inter] text-[#111111]">
      <form id="newsForm">
        {% csrf_token %}
        <!-- Title -->
        <div>
          <label for="title" class="block text-sm font-semibold mb-2">Title</label>
          <input type="text" id="title" name="title"
                 class="w-full border-2 border-[#111111] rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#AA1515]"
                 placeholder="Enter news title" required>
        </div>

        <!-- Content -->
        <div>
          <label for="content" class="block text-sm font-semibold mb-2">Content</label>
          <textarea id="content" name="content" rows="4"
                    class="w-full border-2 border-[#111111] rounded-xl px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-[#AA1515]"
                    placeholder="Enter news content" required></textarea>
        </div>

        <!-- Category -->
        <div>
          <label for="category" class="block text-sm font-semibold mb-2">Category</label>
          <select id="category" name="category"
                  class="w-full border-2 border-[#111111] rounded-xl px-4 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-[#AA1515]" required>
            <option value="">Choose a category</option>
            <option value="match">Match</option>
            <option value="exclusive">Exclusive</option>
            <option value="update">Update</option>
            <option value="analysis">Analysis</option>
            <option value="rumor">Rumor</option>
          </select>
        </div>

        <!-- Thumbnail -->
        <div>
          <label for="thumbnail" class="block text-sm font-semibold mb-2">Thumbnail URL</label>
          <input type="url" id="thumbnail" name="thumbnail"
                 class="w-full border-2 border-[#111111] rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#AA1515]"
                 placeholder="https://example.com/image.jpg">
          <p class="text-xs text-gray-500 mt-1">Optional. Paste a full image URL.</p>
        </div>

        <!-- Featured -->
        <div class="flex items-center mt-3">
          <input id="is_featured" name="is_featured" type="checkbox"
                 class="w-4 h-4 text-[#AA1515] border-2 border-[#111111] rounded focus:ring-[#AA1515]">
          <label for="is_featured" class="ml-2 text-sm font-semibold">Featured News</label>
        </div>
      </form>
    </div>

    <!-- Footer -->
    <div class="flex flex-col sm:flex-row gap-3 px-6 py-5 border-t border-gray-200 bg-[#E7E3DD] rounded-b-2xl">
      <button type="button"
              class="order-2 sm:order-1 w-full sm:w-auto px-6 py-3 border-2 border-[#111111] text-[#111111] bg-white rounded-xl font-bold hover:bg-[#f5f5f5] transition"
              onclick="hideModal()">
        Cancel
      </button>
      <button type="submit"
              form="newsForm"
              class="order-1 sm:order-2 w-full sm:w-auto px-6 py-3 bg-[#AA1515] text-white rounded-xl font-bold border-2 border-[#111111] hover:brightness-110 hover:-translate-y-0.5 transition">
        Publish News
      </button>
    </div>
  </div>
</div>

<!-- Script -->
<script>
  function showModal() {
    const modal = document.getElementById('crudModal');
    const modalContent = document.getElementById('crudModalContent');
    modal.classList.remove('hidden');
    setTimeout(() => {
      modalContent.classList.remove('opacity-0', 'scale-95');
      modalContent.classList.add('opacity-100', 'scale-100');
    }, 30);
  }

  function hideModal() {
    const modal = document.getElementById('crudModal');
    const modalContent = document.getElementById('crudModalContent');
    modalContent.classList.remove('opacity-100', 'scale-100');
    modalContent.classList.add('opacity-0', 'scale-95');
    setTimeout(() => modal.classList.add('hidden'), 180);
  }

  async function addNewsEntry() {
    const res = await fetch("{% url 'news:add_news_entry_ajax' %}", {
      method: "POST",
      body: new FormData(document.querySelector('#newsForm')),
    });

    document.getElementById("newsForm").reset();
    hideModal();

    // Tampilkan toast
    if (typeof showToast === 'function') {
      showToast('Success', 'News added successfully!', 'success');
    }

    // Trigger refresh data di halaman utama
    document.dispatchEvent(new CustomEvent('newsAdded'));
  }

  document.getElementById("newsForm").addEventListener("submit", function(e) {
    e.preventDefault();
    addNewsEntry();
  });
</script>
